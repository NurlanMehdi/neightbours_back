#!/bin/bash

# –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API /api/users/verifications —Å –ø–æ–º–æ—â—å—é curl
# 
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
# 1. –ü–æ–ª—É—á–∏—Ç–µ JWT —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
# 2. –ó–∞–º–µ–Ω–∏—Ç–µ YOUR_JWT_TOKEN –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω
# 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç: bash test-verifications-curl.sh

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
API_BASE_URL="http://localhost:3000/api"
JWT_TOKEN="YOUR_JWT_TOKEN"  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo -e "${BLUE}üöÄ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï API /api/users/verifications${NC}"
echo "============================================================"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
if [ "$JWT_TOKEN" = "YOUR_JWT_TOKEN" ]; then
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∞: –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π JWT —Ç–æ–∫–µ–Ω${NC}"
    echo -e "${YELLOW}üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:${NC}"
    echo "1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: npm run dev"
    echo "2. –ü–æ–ª—É—á–∏—Ç–µ JWT —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ POST /api/auth/login"
    echo "3. –ó–∞–º–µ–Ω–∏—Ç–µ YOUR_JWT_TOKEN –≤ —ç—Ç–æ–º —Å–∫—Ä–∏–ø—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω"
    echo ""
    echo -e "${YELLOW}üì± –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:${NC}"
    echo "1. –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ (+79001234567) - ID: 4"
    echo "2. –ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–∞ (+79001234568) - ID: 5"
    echo "3. –ê–ª–µ–∫—Å–µ–π –°–∏–¥–æ—Ä–æ–≤ (+79001234569) - ID: 6"
    echo "4. –ï–ª–µ–Ω–∞ –ö–æ–∑–ª–æ–≤–∞ (+79001234570) - ID: 7"
    exit 1
fi

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
make_request() {
    local description="$1"
    local url="$2"
    local params="$3"
    
    echo ""
    echo -e "${YELLOW}üìã $description${NC}"
    echo "URL: $url$params"
    echo "–û—Ç–≤–µ—Ç:"
    
    response=$(curl -s -w "\n%{http_code}" \
        -H "Authorization: Bearer $JWT_TOKEN" \
        -H "Content-Type: application/json" \
        "$url$params")
    
    http_code=$(echo "$response" | tail -n1)
    body=$(echo "$response" | head -n -1)
    
    if [ "$http_code" -eq 200 ]; then
        echo -e "${GREEN}‚úÖ –£—Å–ø–µ—à–Ω–æ (HTTP $http_code)${NC}"
        echo "$body" | jq '.' 2>/dev/null || echo "$body"
    else
        echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ (HTTP $http_code)${NC}"
        echo "$body"
    fi
}

# 1. –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤
make_request "1. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" \
    "$API_BASE_URL/users/verifications" \
    "?page=1&limit=10"

# 2. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ)
make_request "2. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–º –æ–±—ä–µ–∫—Ç–∞–º" \
    "$API_BASE_URL/users/verifications" \
    "?page=1&limit=10&isVerified=true"

# 3. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–Ω–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ)
make_request "3. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –Ω–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–º –æ–±—ä–µ–∫—Ç–∞–º" \
    "$API_BASE_URL/users/verifications" \
    "?page=1&limit=10&isVerified=false"

# 4. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (—á–∞—Å—Ç–Ω—ã–µ –¥–æ–º–∞)
make_request "4. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —á–∞—Å—Ç–Ω—ã–º –¥–æ–º–∞–º" \
    "$API_BASE_URL/users/verifications" \
    "?page=1&limit=10&category=PRIVATE_HOUSE"

# 5. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (—Ç–∞—É–Ω—Ö–∞—É—Å—ã)
make_request "5. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∞—É–Ω—Ö–∞—É—Å–∞–º" \
    "$API_BASE_URL/users/verifications" \
    "?page=1&limit=10&category=TOWNHOUSE"

# 6. –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
make_request "6. –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é '–¥–æ–º'" \
    "$API_BASE_URL/users/verifications" \
    "?page=1&limit=10&search=–¥–æ–º"

# 7. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–µ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π)
DATE_FROM=$(date -d "30 days ago" +%Y-%m-%d 2>/dev/null || date -v-30d +%Y-%m-%d 2>/dev/null || echo "2024-01-01")
make_request "7. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π" \
    "$API_BASE_URL/users/verifications" \
    "?page=1&limit=10&dateFrom=$DATE_FROM"

# 8. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
make_request "8. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å (—Ç–∞—É–Ω—Ö–∞—É—Å—ã + –ø–æ–∏—Å–∫)" \
    "$API_BASE_URL/users/verifications" \
    "?page=1&limit=5&category=TOWNHOUSE&search=—Ç–∞—É–Ω—Ö–∞—É—Å"

# 9. –ü–∞–≥–∏–Ω–∞—Ü–∏—è (–≤—Ç–æ—Ä–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
make_request "9. –ü–∞–≥–∏–Ω–∞—Ü–∏—è - –≤—Ç–æ—Ä–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞" \
    "$API_BASE_URL/users/verifications" \
    "?page=2&limit=5"

echo ""
echo -e "${BLUE}üìö –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø API${NC}"
echo "============================================================"
echo -e "${YELLOW}üîó Endpoint:${NC} GET /api/users/verifications"
echo -e "${YELLOW}üìù –û–ø–∏—Å–∞–Ω–∏–µ:${NC} –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö —Ç–µ–∫—É—â–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º"
echo ""
echo -e "${YELLOW}üîß –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:${NC}"
echo "‚Ä¢ page (number) - –ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1)"
echo "‚Ä¢ limit (number) - –≠–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10)"
echo "‚Ä¢ search (string) - –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –æ–±—ä–µ–∫—Ç–∞"
echo "‚Ä¢ category (enum) - –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ–±—ä–µ–∫—Ç–∞"
echo "‚Ä¢ isVerified (boolean) - –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è"
echo "‚Ä¢ dateFrom (string) - –î–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç (YYYY-MM-DD)"
echo "‚Ä¢ dateTo (string) - –î–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–æ (YYYY-MM-DD)"
echo ""
echo -e "${YELLOW}üè† –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤:${NC}"
echo "‚Ä¢ PRIVATE_HOUSE - –ß–∞—Å—Ç–Ω—ã–π –¥–æ–º"
echo "‚Ä¢ TOWNHOUSE - –¢–∞—É–Ω—Ö–∞—É—Å"
echo "‚Ä¢ COTTAGE - –ö–æ—Ç—Ç–µ–¥–∂"
echo "‚Ä¢ LAND - –ó–µ–º–µ–ª—å–Ω—ã–π —É—á–∞—Å—Ç–æ–∫"
echo ""
echo -e "${GREEN}‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ${NC}"