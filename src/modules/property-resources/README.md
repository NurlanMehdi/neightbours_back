# Модуль ресурсов объектов недвижимости

Этот модуль предоставляет CRUD операции для ресурсов объектов недвижимости.

## Описание

Ресурсы объектов недвижимости - это дополнительные объекты, связанные с основным объектом недвижимости. Каждый ресурс имеет:
- Название
- Фотографию
- Категорию (Скважина, Генератор, Септик, Другая)

## Настройка

### 1. Создание миграции

После добавления модели `PropertyResource` в `prisma/schema.prisma`, необходимо создать и применить миграцию:

```bash
npx prisma migrate dev --name add_property_resources
```

### 2. Генерация Prisma клиента

После создания миграции необходимо сгенерировать Prisma клиент:

```bash
npx prisma generate
```

### 3. Активация репозитория

После генерации клиента необходимо раскомментировать код в файле `src/modules/property-resources/repositories/property-resource.repository.ts`.

## API Endpoints

### Создание ресурса
```
POST /property-resources
Content-Type: multipart/form-data

{
  "name": "Скважина на участке",
  "category": "WELL",
  "propertyId": 1,
  "photo": [файл]
}
```

**Проверки:**
- Объект недвижимости должен существовать
- Пользователь должен быть владельцем объекта недвижимости

### Получение всех ресурсов пользователя
```
GET /property-resources
Authorization: Bearer <token>
```

### Получение ресурсов конкретного объекта недвижимости
```
GET /property-resources/property/:propertyId
Authorization: Bearer <token>
```

**Проверки:**
- Объект недвижимости должен существовать
- Пользователь должен быть владельцем объекта недвижимости

### Получение ресурса по ID
```
GET /property-resources/:id
Authorization: Bearer <token>
```

**Проверки:**
- Ресурс должен существовать
- Пользователь должен быть владельцем ресурса

### Обновление ресурса
```
PATCH /property-resources/:id
Content-Type: multipart/form-data

{
  "name": "Обновленное название",
  "category": "GENERATOR",
  "photo": [файл]
}
```

**Проверки:**
- Ресурс должен существовать
- Пользователь должен быть владельцем ресурса

**Особенности:**
- Обновляются только измененные поля
- Если поле не передано или не изменилось, оно остается без изменений
- Если нет изменений, возвращается текущий ресурс без обновления в базе данных

### Удаление ресурса
```
DELETE /property-resources/:id
Authorization: Bearer <token>
```

**Проверки:**
- Ресурс должен существовать
- Пользователь должен быть владельцем ресурса

## Категории ресурсов

- `WELL` - Скважина
- `GENERATOR` - Генератор
- `SEPTIC` - Септик
- `OTHER` - Другая

## Безопасность

- Все операции требуют авторизации (JWT токен)
- Пользователи могут работать только со своими ресурсами
- Проверка существования объектов недвижимости перед созданием ресурсов
- Проверка принадлежности ресурса пользователю на всех операциях

## Исключения

Модуль использует специальные исключения для различных случаев:

- `PropertyResourceNotFoundException` - ресурс не найден
- `PropertyResourceAccessDeniedException` - доступ к ресурсу запрещен
- `PropertyNotFoundException` - объект недвижимости не найден
- `PropertyAccessDeniedException` - доступ к объекту недвижимости запрещен

## Файлы

- Фотографии сохраняются в директории `uploads/`
- Поддерживаются форматы: jpg, jpeg, png, gif, svg
- Максимальный размер файла: 5MB 